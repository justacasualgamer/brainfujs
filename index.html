<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brainfujs</title>
    <link rel="icon" href="brainfujs.png" type="image/x-icon">
    <style>
        div {
            border: 1px solid black;
            display: inline;
            padding: 5px 12px;
            font-family: monospace;
        }
        div#ou {
            display: block;
        }
        textarea, button {
            display: block;
            margin: 2px 0;
        }
        h1 {
            font-family: monospace;
            font-size: 19px
        }
        button#save {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <textarea id="i"></textarea>
    <button onclick="code()">Run code</button>
    <div id="ou">
        <pre id="o"></pre>
    </div>
    <h1>Output format</h1>
    <input type="radio" name="o-form" value="num" id="n">
    <label for="n">Number</label>
    <input type="radio" name="o-form" value="text" id="a2">
    <label for="a2">ASCII (i suppose)</label>
    <h1>Memory</h1>
    <pre id="m">0</pre>
    <button id="save" onclick="copy()">Copy code</button>
    <script>
        var tempStr = "", tempNum = "", f = 0;
        document.addEventListener("keydown", (e) => {
            if (e.key == "Enter") {
                code();
            }
        });
        function code() {
            var r = 0;
            tempStr = "";
            tempNum = "";
            document.getElementById("o").textContent = "";
            document.getElementById("i").disabled = true;
            const code = document.getElementById("i").value;
            var memi = 0;
            var mem = [0];
            for (var i=0; i < code.length; i++) {
                switch (code[i]) {
                    case "+":
                        mem[memi] += 1;
                        document.getElementById("m").textContent = mem.join(" | ");
                        break;
                    case "-":
                        mem[memi] -= 1;
                        document.getElementById("m").textContent = mem.join(" | ");
                        break;
                    case "<":
                        memi -= 1;
                        if (memi < 0) {
                            memi = 0;
                        }
                        break;
                    case ">":
                        memi += 1;
                        if (memi >= mem.length) {
                            mem.push(0);
                            document.getElementById("m").textContent = mem.join(" | ");
                        }
                        break;
                    case ".":
                        tempStr = tempStr.concat(String.fromCharCode(mem[memi]));
                        tempNum = tempNum.concat(String(mem[memi]));
                        break;
                    case ",":
                        mem[memi] = window.prompt("Enter input");
                        if (!isNaN(Number(mem[memi]))) {
                            if (String(mem[memi]).includes("e") || String(mem[memi]).includes(".")) {
                                document.getElementById("o").textContent = "No.";
                                document.getElementById("i").disabled = false;
                                return;
                            }
                            if (String(mem[memi]).trim() == "") {
                                document.getElementById("o").textContent = "Why would you do that?";
                                document.getElementById("i").disabled = false;
                                return;
                            }

                        } else {
                            document.getElementById("o").textContent = "Invalid input.";
                            document.getElementById("i").disabled = false;
                            return;
                        }
                        document.getElementById("m").textContent = mem.join(" | ");
                        break;
                    case "[":
                        r++;
                        if (mem[memi] < 1) {
                            while (code[i] != "]") {
                                i += 1;
                            }
                            r--;
                            break;
                        }
                        break;
                    case "]":
                        if (mem[memi] > 0 && r > 0) {
                            while (code[i] != "[") {
                                i -= 1;
                            }
                            break;
                        } else if (r==0) {
                            document.getElementById("o").textContent = "Recount the brackets";
                            document.getElementById("i").disabled = false;
                            return;
                            break;
                        }
                        r--;
                        break;
                    default:
                        document.getElementById("o").textContent = "Invalid expression.";
                        document.getElementById("i").disabled = false;
                        return;
                        break;
                }
            }
            document.getElementById("i").disabled = false;
            if (f == 0) {
                document.getElementById("o").textContent = Number(tempNum);
            } else if (f == 1) {
                document.getElementById("o").textContent = tempStr;
            }
        }
        document.querySelectorAll("[name=\"o-form\"]")[0].addEventListener("change", () => {
            console.log("n");
            f = 0;
            document.getElementById("o").textContent = Number(tempNum);
        });
        document.querySelectorAll("[name=\"o-form\"]")[1].addEventListener("change", () => {
            console.log("a");
            f = 1;
            document.getElementById("o").textContent = tempStr;
        });
        function copy() {
            const text = document.getElementById("i").value;
            navigator.clipboard.writeText(text);
            document.getElementById("save").textContent = "Copied!";
            setTimeout(() => {
                document.getElementById("save").textContent = "Copy code";
            }, 600);
        }
    </script>
</body>
</html>